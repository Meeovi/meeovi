// ============================================================================
// Normalized Commerce Types - Provider Agnostic
// ============================================================================

// Common Types
export interface Money {
  amount: number
  currency: string
}

export interface Image {
  url: string
  alt?: string
  width?: number
  height?: number
}

export interface Address {
  firstName?: string
  lastName?: string
  company?: string
  street: string
  street2?: string
  city: string
  state?: string
  postcode: string
  country: string
  phone?: string
}

// Product Types
export interface ProductImage {
  id: string
  url: string
  alt?: string
  position?: number
}

export interface ProductVariant {
  id: string
  sku: string
  name: string
  price: Money
  regularPrice?: Money
  inStock: boolean
  stockQuantity?: number
  attributes: Record<string, string>
  image?: ProductImage
}

export interface ProductAttribute {
  code: string
  label: string
  value: string | string[]
}

export interface ProductCategory {
  id: string
  name: string
  slug: string
  path?: string
}

export interface ProductBrand {
  id: string
  name: string
  slug: string
  logo?: string
}

export interface ProductReview {
  id: string
  rating: number
  title?: string
  text: string
  author: string
  date: string
}

export interface CommerceProduct {
  id: string
  sku: string
  name: string
  slug: string
  description?: string
  shortDescription?: string
  price: Money
  regularPrice?: Money
  finalPrice?: Money
  specialPrice?: Money
  inStock: boolean
  stockQuantity?: number
  images: ProductImage[]
  variants?: ProductVariant[]
  categories: ProductCategory[]
  brand?: ProductBrand
  attributes: ProductAttribute[]
  rating?: {
    average: number
    count: number
  }
  reviews?: ProductReview[]
  metaTitle?: string
  metaDescription?: string
  url?: string
}

// Category Types
export interface CommerceCategory {
  id: string
  name: string
  slug: string
  description?: string
  image?: Image
  parentId?: string
  children?: CommerceCategory[]
  productCount?: number
  path?: string
  level?: number
}

// Cart Types
export interface CartItem {
  id: string
  productId: string
  variantId?: string
  sku: string
  name: string
  quantity: number
  price: Money
  rowTotal: Money
  image?: ProductImage
  attributes?: Record<string, string>
}

export interface CartTotals {
  subtotal: Money
  shipping?: Money
  tax?: Money
  discount?: Money
  grandTotal: Money
}

export interface CommerceCart {
  id: string
  items: CartItem[]
  totals: CartTotals
  couponCode?: string
  itemCount: number
}

// Customer Types
export interface CommerceCustomer {
  id: string
  email: string
  firstName: string
  lastName: string
  phone?: string
  addresses?: Address[]
  defaultBillingAddress?: Address
  defaultShippingAddress?: Address
}

// Order Types
export interface OrderItem {
  id: string
  productId: string
  variantId?: string
  sku: string
  name: string
  quantity: number
  price: Money
  rowTotal: Money
  image?: ProductImage
}

export interface OrderAddress {
  firstName: string
  lastName: string
  company?: string
  street: string[]
  city: string
  region?: string
  postcode: string
  country: string
  phone?: string
}

export interface OrderShipment {
  id: string
  trackingNumber?: string
  carrier?: string
  method: string
  status: string
  items: Array<{
    orderItemId: string
    quantity: number
  }>
}

export interface OrderPayment {
  method: string
  transactionId?: string
  status: string
  amount: Money
}

export interface CommerceOrder {
  id: string
  orderNumber: string
  status: string
  items: OrderItem[]
  totals: CartTotals
  billingAddress: OrderAddress
  shippingAddress: OrderAddress
  shippingMethod?: string
  payment: OrderPayment
  shipments?: OrderShipment[]
  createdAt: string
  updatedAt?: string
}

// Search & Filter Types
export interface FilterOption {
  value: string
  label: string
  count?: number
}

export interface ProductFilter {
  code: string
  label: string
  type: 'select' | 'multiselect' | 'range' | 'boolean'
  options?: FilterOption[]
  min?: number
  max?: number
}

export interface SortOption {
  field: string
  direction: 'asc' | 'desc'
}

export interface CommerceListParams {
  search?: string
  page?: number
  pageSize?: number
  filters?: Record<string, string | string[] | number[]>
  sort?: SortOption
  categoryId?: string
}

export interface CommerceListResult<T> {
  items: T[]
  total: number
  page: number
  pageSize: number
  totalPages: number
}

// ============================================================================
// Provider Adapter Interface
// ============================================================================

export interface CommerceProvider {
  // Product Operations
  getProduct(id: string): Promise<CommerceProduct | null>
  getProducts(params?: CommerceListParams): Promise<CommerceListResult<CommerceProduct>>
  getProductBySku(sku: string): Promise<CommerceProduct | null>
  searchProducts(query: string, params?: CommerceListParams): Promise<CommerceListResult<CommerceProduct>>
  
  // Category Operations
  getCategory(id: string): Promise<CommerceCategory | null>
  getCategories(parentId?: string): Promise<CommerceCategory[]>
  getCategoryTree(): Promise<CommerceCategory[]>
  
  // Cart Operations
  createCart(): Promise<CommerceCart>
  getCart(cartId: string): Promise<CommerceCart | null>
  addToCart(cartId: string, productId: string, quantity: number, variantId?: string): Promise<CommerceCart>
  updateCartItem(cartId: string, itemId: string, quantity: number): Promise<CommerceCart>
  removeFromCart(cartId: string, itemId: string): Promise<CommerceCart>
  applyCoupon(cartId: string, couponCode: string): Promise<CommerceCart>
  removeCoupon(cartId: string): Promise<CommerceCart>
  
  // Customer Operations
  getCustomer(customerId: string): Promise<CommerceCustomer | null>
  createCustomer(data: Partial<CommerceCustomer>): Promise<CommerceCustomer>
  updateCustomer(customerId: string, data: Partial<CommerceCustomer>): Promise<CommerceCustomer>
  
  // Order Operations
  getOrder(orderId: string): Promise<CommerceOrder | null>
  getCustomerOrders(customerId: string, params?: CommerceListParams): Promise<CommerceListResult<CommerceOrder>>
  createOrder(cartId: string, shippingAddress: Address, billingAddress: Address, paymentMethod: string): Promise<CommerceOrder>
}

// ============================================================================
// Provider Context & Factory Types
// ============================================================================

export interface ProviderConfig {
  provider: 'magento' | 'shopify' | 'woocommerce' | 'medusa'
  endpoint: string
  token?: string
  storeCode?: string
  apiVersion?: string
  [key: string]: unknown
}

export interface ProviderContext extends ProviderConfig {
  logger?: {
    info: (message: string, ...args: unknown[]) => void
    error: (message: string, ...args: unknown[]) => void
    warn: (message: string, ...args: unknown[]) => void
  }
}

export type ProviderFactory = (ctx: ProviderContext) => CommerceProvider
