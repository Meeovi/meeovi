import type { CommerceProvider } from '../types.js'

export type ProviderName = string

// Generic provider context to allow provider-specific configuration.
export type ProviderContext = Record<string, unknown>

export type ProviderFactory = (ctx: ProviderContext) => CommerceProvider

const providers: Record<string, ProviderFactory> = {}

export const registerProvider = (name: string, factory: ProviderFactory) => {
  providers[name] = factory
}

export const createProvider = (name: string, ctx: ProviderContext): CommerceProvider => {
  const factory = providers[name]
  if (!factory) {
    throw new Error(`Commerce provider "${name}" is not registered`)
  }
  return factory(ctx)
}
