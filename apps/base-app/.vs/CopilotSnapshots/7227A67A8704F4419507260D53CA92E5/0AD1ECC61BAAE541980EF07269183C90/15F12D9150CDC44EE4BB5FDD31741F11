import { useGqlQuery } from './useGqlQuery'
import type {
  ProductsQuery,
  ProductsQueryVariables } from '../generated/magento/graphql'
import {
  ProductsDocument,
} from '../generated/magento/graphql'

import { mapMagentoProduct } from '../providers/magento'
import { computed } from 'vue'

export function useMagento() {
  return {
    getProduct: (sku: string) => {
      const { result, loading, error } = useGqlQuery<
        ProductsQuery,
        ProductsQueryVariables
      >(ProductsDocument, {
        filter: {
          sku: { eq: sku },
        },
      })

      const product = computed(() => {
        const item = result.value?.products?.items?.[0]
        return item ? mapMagentoProduct(item) : null
      })

      return { product, loading, error }
    },
  }
}
